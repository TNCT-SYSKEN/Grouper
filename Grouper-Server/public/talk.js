// Generated by CoffeeScript 1.7.1
$(function() {
  var channel, dispatcher, group_id;
  url = "ws://localhost:3000/websocket"
  dispatcher = new WebSocketRails("ws://secure-bayou-4662.herokuapp.com/websocket", true);
  //dispatcher = new WebSocketRails("ws://localhost:3000/websocket");
  //console.log($('#chat').data('uri'));
  //var url = $('#chat').data('uri');
  group_id = $('#gid').text();
  channel = dispatcher.subscribe(group_id);
  return channel.bind("new_message", function(message) {
    if( message.img_exist == 1 ) {
      if (message.type == 0) {
        return $(".talk_tbody").append('<tr class="talk_user_name"><th colspan="3">' + message.name + '</th></tr><tr class="talk_body"><th class="user"><img src="/img/user/' + message.user_id + '" class="img-circle user-img" style="width: 50px; height: 50px;"></th><th class="content"><p>' + message.talk + '</p></th></tr>');
      } else if(message.type == 1) {
        return $(".talk_tbody").append('<tr class="talk_user_name"><th colspan="3">' + message.name + '</th></tr><tr class="talk_body"><th class="user"><img src="/img/user/' + message.user_id + '" class="img-circle user-img" style="width: 50px; height: 50px;"></th><th class="content"><p class="talk-img"><a class="img-link" href="/img/talk/' + message.id + '"><img src="/img/talk/' + messsage.id + '" style="width: 100px;" ></a></p></th></tr>');
      } else {
        return $(".talk_tbody").append('<tr class="talk_user_name"><th colspan="3">' + message.name + '</th></tr><tr class="talk_body"><th class="user"><img src="/img/user/' + message.user_id + '" class="img-circle user-img" style="width: 50px; height: 50px;"></th><th class="content"><p><a class="map-link" href="https://www.google.co.jp/maps/place/' + message.talk + '" class="map-link">' + message.talk + '</a></p></th></tr>');
      }

    } else {
      if (message.type == 0) {
        return $(".talk_tbody").append('<tr class="talk_user_name"><th colspan="3">' + message.name + '</th></tr><tr class="talk_body"><th class="user"><img src="/user/default.png" class="img-circle user-img" style="width: 50px; height: 50px;"></th><th class="content"><p>' + message.talk + '</p></th></tr>');
      } else if(message.type == 1) {
        return $(".talk_tbody").append('<tr class="talk_user_name"><th colspan="3">' + message.name + '</th></tr><tr class="talk_body"><th class="user"><img src="/user/default.png" class="img-circle user-img" style="width: 50px; height:50px;"></th><th class="content"><p><a href="/img/talk/' + message.id + '"><img src="/img/talk/' + messsage.id + '" style="width: 100px;" ></a></p></th></tr>');
      } else {
        return $(".talk_tbody").append('<tr class="talk_user_name"><th colspan="3">' + message.name + '</th></tr><tr class="talk_body"><th class="user"><img src="/user/default.png" class="img-circle user-img" style="width: 50px; height: 50px;"></th><th class="content"><p><a href="https://www.google.co.jp/maps/place/' + message.talk + '" class="map-link">' + message.talk + '</a></p></th></tr>');
      }

    }
  });
});
